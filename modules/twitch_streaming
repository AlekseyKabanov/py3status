
"""
Checks if a streamer is online. [Gross Gore or grossie_gore as example placeholder]

Configuration parameters:
    - cache_timeout : how often we refresh this module in seconds
    - stream_name : name of streamer(twitch.tv/<streamer_name>)
@author Alex Caswell horatioesf@virginmedia.com
@license BSD
"""

# import your useful libs here
from time import time
import requests


class Py3status:
    """
    The Py3status class name is mandatory.
    Below you list all the available configuration parameters and their
    default value for your module which can be overwritten by users
    directly from their i3status config.
    This examples features only one parameter which is 'cache_timeout'
    and is set to 10 seconds (0 would mean no cache).
    """
    # available configuration parameters
    cache_timeout = 10
    stream_name = "grossie_gore"

    def is_streaming(self, i3s_output_list, i3s_config):
        r = requests.get('https://api.twitch.tv/kraken/streams/' + self.stream_name)
        if r.json()['stream'] == None: 
            answer=" is offline."
            colour=i3s_config['color_bad']
        else: 
            answer=" is live!"
            colour=i3s_config['color_good']
        response = {
            'cached_until': time() + self.cache_timeout,
            'full_text': self.stream_name + answer,
            'color': colour
        }
        return response

if __name__ == "__main__":
    from time import sleep
    x = Py3status()
    config = {
        'color_bad': '#FF0000',
        'color_good': '#00FF00'
    }
    while True:
        print(x.is_streaming([], config))
        sleep(1)
